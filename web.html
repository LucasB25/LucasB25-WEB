<!DOCTYPE html>
<html lang="en" class="transition-colors duration-300">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Master Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    animation: { 
                        blob: "blob 10s infinite",
                        'fade-in': 'fadeIn 0.3s ease-out forwards',
                        'slide-in': 'slideIn 0.3s ease-out forwards'
                    },
                    keyframes: {
                        blob: {
                            "0%": { transform: "translate(0px, 0px) scale(1)" },
                            "33%": { transform: "translate(30px, -50px) scale(1.1)" },
                            "66%": { transform: "translate(-20px, 20px) scale(0.9)" },
                            "100%": { transform: "translate(0px, 0px) scale(1)" },
                        },
                        fadeIn: {
                            "0%": { opacity: "0" },
                            "100%": { opacity: "1" }
                        },
                        slideIn: {
                            "0%": { transform: "translateY(20px)", opacity: "0" },
                            "100%": { transform: "translateY(0)", opacity: "1" }
                        }
                    },
                    colors: {
                        dark: {
                            bg: '#0f172a',
                            card: '#1e293b',
                            text: '#f1f5f9'
                        }
                    }
                },
            },
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .dark ::-webkit-scrollbar-thumb { background: #475569; }

        #qrcode img {
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .hidden-section { display: none; }
        
        .type-radio:checked + label {
            background-color: #EEF2FF;
            color: #4F46E5;
            border-color: #6366f1;
            font-weight: 700;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.1);
        }
        .dark .type-radio:checked + label {
            background-color: #312e81;
            color: #c7d2fe;
            border-color: #6366f1;
        }

        #toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-8 px-4 relative overflow-x-hidden text-slate-800 bg-slate-50 dark:bg-dark-bg dark:text-dark-text transition-colors duration-300">

    <!-- Contrôles Haut Droite (Langue + Thème) -->
    <div class="fixed top-6 right-6 z-50 flex items-center gap-3">
        <!-- Bouton Langue -->
        <button onclick="toggleLanguage()" class="p-3 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur shadow-lg border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform font-bold text-xs w-12 h-12 flex items-center justify-center text-slate-700 dark:text-slate-200" id="langBtn">
            EN
        </button>

        <!-- Bouton Mode Sombre -->
        <button onclick="toggleDarkMode()" class="p-3 rounded-full bg-white/80 dark:bg-slate-800/80 backdrop-blur shadow-lg border border-slate-200 dark:border-slate-700 hover:scale-110 transition-transform group w-12 h-12 flex items-center justify-center">
            <i class="fa-solid fa-moon text-indigo-600 dark:hidden text-lg"></i>
            <i class="fa-solid fa-sun text-yellow-400 hidden dark:block text-lg"></i>
        </button>
    </div>

    <!-- Arrière-plan animé -->
    <div class="fixed inset-0 z-0 pointer-events-none w-full h-full overflow-hidden opacity-60 dark:opacity-30">
        <div class="absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
        <div class="absolute top-[-10%] right-[-10%] w-96 h-96 bg-indigo-300 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
        <div class="absolute bottom-[-20%] left-[20%] w-96 h-96 bg-blue-300 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
    </div>

    <!-- Conteneur Principal -->
    <div class="relative z-10 w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
        
        <!-- COLONNE GAUCHE : Configuration (Span 7) -->
        <main class="lg:col-span-7 bg-white/90 dark:bg-dark-card/90 backdrop-blur-xl rounded-[2rem] shadow-2xl border border-white/60 dark:border-slate-700/60 p-6 md:p-8 space-y-8 animate-slide-in">
            
            <header class="flex items-center space-x-4 border-b border-slate-100 dark:border-slate-700 pb-6">
                <div class="p-3 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl shadow-lg text-white">
                    <i class="fa-solid fa-qrcode text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400" data-i18n="title">
                        QR Master Ultimate
                    </h1>
                    <p class="text-slate-500 dark:text-slate-400 text-sm font-medium" data-i18n="subtitle">Universal & Free Generator</p>
                </div>
            </header>

            <!-- NAVIGATION DES TYPES (Scrollable) -->
            <div class="flex overflow-x-auto pb-4 gap-3 no-scrollbar snap-x">
                
                <!-- URL -->
                <input type="radio" name="qrType" id="typeURL" value="url" class="hidden type-radio" checked onchange="handleTypeChange()">
                <label for="typeURL" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-link text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabUrl">URL</span>
                </label>

                <!-- WIFI -->
                <input type="radio" name="qrType" id="typeWifi" value="wifi" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeWifi" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-wifi text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabWifi">Wi-Fi</span>
                </label>

                <!-- TEXTE -->
                <input type="radio" name="qrType" id="typeText" value="text" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeText" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-align-left text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabText">Text</span>
                </label>

                <!-- VCARD -->
                <input type="radio" name="qrType" id="typeVcard" value="vcard" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeVcard" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-address-card text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabVcard">Contact</span>
                </label>

                <!-- WHATSAPP -->
                <input type="radio" name="qrType" id="typeWhatsapp" value="whatsapp" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeWhatsapp" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-brands fa-whatsapp text-xl text-slate-400 group-hover:text-green-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabWhatsapp">WhatsApp</span>
                </label>

                <!-- EVENT -->
                <input type="radio" name="qrType" id="typeEvent" value="event" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeEvent" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-calendar-days text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabEvent">Event</span>
                </label>

                <!-- CRYPTO -->
                <input type="radio" name="qrType" id="typeCrypto" value="crypto" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeCrypto" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-brands fa-bitcoin text-xl text-slate-400 group-hover:text-yellow-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabCrypto">Crypto</span>
                </label>

                <!-- GEO -->
                <input type="radio" name="qrType" id="typeGeo" value="geo" class="hidden type-radio" onchange="handleTypeChange()">
                <label for="typeGeo" class="snap-start min-w-[90px] cursor-pointer text-center p-3 border border-slate-200 dark:border-slate-700 rounded-xl hover:bg-slate-50 dark:hover:bg-slate-800 transition-all flex flex-col items-center gap-2 group">
                    <i class="fa-solid fa-map-location-dot text-xl text-slate-400 group-hover:text-indigo-500 transition-colors"></i>
                    <span class="text-xs font-semibold" data-i18n="tabGeo">GPS</span>
                </label>
            </div>

            <!-- ZONES DE SAISIE -->
            <div class="space-y-6 min-h-[250px]">
                
                <!-- URL -->
                <div id="section-url" class="input-section space-y-3 animate-fade-in">
                    <label class="block text-sm font-bold ml-1 dark:text-slate-200" data-i18n="labelUrl">Destination URL</label>
                    <div class="relative">
                        <input type="text" id="urlInput" oninput="triggerLiveGen()" placeholder="https://monsite.com" class="w-full pl-4 pr-10 py-4 bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-600 rounded-xl focus:border-indigo-500 focus:ring-0 outline-none transition-all dark:text-white" value="https://google.com">
                        <i class="fa-solid fa-globe absolute right-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    </div>
                </div>

                <!-- WHATSAPP -->
                <div id="section-whatsapp" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelWaPhone">WhatsApp Number</label>
                        <input type="tel" id="waPhone" oninput="triggerLiveGen()" data-i18n-placeholder="phWaPhone" placeholder="+33 6 12 34 56 78" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-green-500 dark:text-white">
                        <p class="text-[10px] text-slate-400 ml-1 mt-1" data-i18n="waHelp">Include country code (e.g. +33)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelWaMsg">Pre-filled Message</label>
                        <textarea id="waMessage" oninput="triggerLiveGen()" rows="3" data-i18n-placeholder="phWaMsg" placeholder="Hello..." class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-green-500 dark:text-white resize-none"></textarea>
                    </div>
                </div>

                <!-- EVENT -->
                <div id="section-event" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelTitle">Event Title</label>
                        <input type="text" id="evTitle" oninput="triggerLiveGen()" data-i18n-placeholder="phTitle" placeholder="Meeting..." class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelStart">Start</label>
                            <input type="datetime-local" id="evStart" oninput="triggerLiveGen()" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelEnd">End</label>
                            <input type="datetime-local" id="evEnd" oninput="triggerLiveGen()" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white text-sm">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelLoc">Location</label>
                        <input type="text" id="evLoc" oninput="triggerLiveGen()" data-i18n-placeholder="phLoc" placeholder="New York..." class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                    </div>
                </div>

                <!-- CRYPTO -->
                <div id="section-crypto" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelCoin">Currency Type</label>
                        <select id="cryptoType" onchange="triggerLiveGen()" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-yellow-500 dark:text-white">
                            <option value="bitcoin">Bitcoin (BTC)</option>
                            <option value="ethereum">Ethereum (ETH)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelAddr">Wallet Address</label>
                        <input type="text" id="cryptoAddr" oninput="triggerLiveGen()" data-i18n-placeholder="phAddr" placeholder="1A1z..." class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-yellow-500 dark:text-white font-mono text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelAmount">Amount (Optional)</label>
                        <input type="number" step="0.0001" id="cryptoAmount" oninput="triggerLiveGen()" data-i18n-placeholder="phAmount" placeholder="0.5" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-yellow-500 dark:text-white">
                    </div>
                </div>

                <!-- GEO -->
                <div id="section-geo" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelLat">Latitude</label>
                            <input type="text" id="geoLat" oninput="triggerLiveGen()" data-i18n-placeholder="phLat" placeholder="48.8566" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelLon">Longitude</label>
                            <input type="text" id="geoLon" oninput="triggerLiveGen()" data-i18n-placeholder="phLon" placeholder="2.3522" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                    </div>
                    <button onclick="getMyLocation()" class="w-full py-3 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 font-bold rounded-xl hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition flex items-center justify-center gap-2">
                        <i class="fa-solid fa-location-crosshairs"></i> <span data-i18n="btnLoc">Use my location</span>
                    </button>
                </div>

                <!-- WIFI -->
                <div id="section-wifi" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div>
                        <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelSsid">Network Name (SSID)</label>
                        <input type="text" id="wifiSSID" oninput="triggerLiveGen()" data-i18n-placeholder="phSsid" placeholder="MyNetwork" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelPass">Password</label>
                            <input type="text" id="wifiPass" oninput="triggerLiveGen()" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelSecurity">Security</label>
                            <div class="relative group z-30">
                                <button type="button" id="wifiTypeBtn" onclick="toggleSecurityMenu()" class="w-full p-3.5 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white flex justify-between items-center text-left hover:bg-slate-100 dark:hover:bg-slate-700/50 transition-colors">
                                    <span id="wifiTypeLabel" class="flex items-center gap-2"><i class="fa-solid fa-lock text-indigo-500 text-xs"></i> WPA/WPA2</span>
                                    <i class="fa-solid fa-chevron-down text-xs text-slate-400"></i>
                                </button>
                                <div id="wifiTypeMenu" class="hidden absolute top-full left-0 right-0 mt-2 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl shadow-xl overflow-hidden animate-fade-in">
                                    <div onclick="setSecurity('WPA', 'WPA/WPA2', 'fa-lock text-indigo-500')" class="p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer flex items-center gap-2 dark:text-white">
                                        <i class="fa-solid fa-lock text-indigo-500 text-xs w-5 text-center"></i> WPA/WPA2
                                    </div>
                                    <div onclick="setSecurity('WEP', 'WEP', 'fa-shield-halved text-orange-500')" class="p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer flex items-center gap-2 dark:text-white">
                                        <i class="fa-solid fa-shield-halved text-orange-500 text-xs w-5 text-center"></i> WEP
                                    </div>
                                    <div onclick="setSecurity('nopass', 'None', 'fa-lock-open text-red-500')" class="p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer flex items-center gap-2 dark:text-white">
                                        <i class="fa-solid fa-lock-open text-red-500 text-xs w-5 text-center"></i> <span data-i18n="securityNone">None</span>
                                    </div>
                                </div>
                                <input type="hidden" id="wifiType" value="WPA">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VCARD -->
                <div id="section-vcard" class="input-section space-y-4 hidden-section animate-fade-in">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelFirst">First Name</label>
                            <input type="text" id="vcardFirst" oninput="triggerLiveGen()" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelLast">Last Name</label>
                            <input type="text" id="vcardLast" oninput="triggerLiveGen()" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelPhone">Phone</label>
                            <input type="tel" id="vcardPhone" oninput="triggerLiveGen()" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-bold ml-1 mb-1 dark:text-slate-200" data-i18n="labelEmail">Email</label>
                            <input type="email" id="vcardEmail" oninput="triggerLiveGen()" class="w-full p-3 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-xl outline-none focus:border-indigo-500 dark:text-white">
                        </div>
                    </div>
                </div>

                <!-- TEXT -->
                <div id="section-text" class="input-section hidden-section animate-fade-in">
                    <label class="block text-sm font-bold ml-1 mb-2 dark:text-slate-200" data-i18n="labelText">Free Text</label>
                    <textarea id="textInput" oninput="triggerLiveGen()" rows="5" class="w-full p-4 bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-600 rounded-xl focus:border-indigo-500 outline-none dark:text-white resize-none"></textarea>
                </div>
            </div>

            <!-- OPTIONS AVANCÉES -->
            <div class="border-t border-slate-100 dark:border-slate-700 pt-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-bold flex items-center text-slate-500 dark:text-slate-400"><i class="fa-solid fa-sliders mr-2"></i><span data-i18n="headerCust">Customization</span></h3>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Couleur -->
                    <div class="relative group">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block" data-i18n="labelColor">Color</label>
                        <div class="relative h-10 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 flex items-center px-2 cursor-pointer overflow-hidden">
                            <input type="color" id="colorDark" oninput="triggerLiveGen()" value="#4F46E5" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                            <div id="previewDark" class="h-6 w-6 rounded border border-black/10 shadow-sm mr-2" style="background-color: #4F46E5;"></div>
                            <span class="text-xs font-mono dark:text-white" data-i18n="labelCode">Code</span>
                        </div>
                    </div>
                    <!-- Fond -->
                    <div class="relative group">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block" data-i18n="labelBg">Background</label>
                        <div class="relative h-10 bg-slate-50 dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-600 flex items-center px-2 cursor-pointer overflow-hidden">
                            <input type="color" id="colorLight" oninput="triggerLiveGen()" value="#FFFFFF" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                            <div id="previewLight" class="h-6 w-6 rounded border border-black/10 shadow-sm mr-2" style="background-color: #FFFFFF;"></div>
                            <span class="text-xs font-mono dark:text-white" data-i18n="labelBgInd">Back</span>
                        </div>
                    </div>
                    <!-- Correction (ECC) -->
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 mb-1 block" data-i18n="labelEcc">Error Correction</label>
                        <select id="eccLevel" onchange="triggerLiveGen()" class="w-full h-10 pl-2 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-600 rounded-lg text-xs font-bold dark:text-white outline-none cursor-pointer">
                            <option value="L">Low (7%)</option>
                            <option value="M" selected>Medium (15%)</option>
                            <option value="Q">Quartile (25%)</option>
                            <option value="H">High (30%)</option>
                        </select>
                    </div>
                </div>
            </div>

        </main>

        <!-- COLONNE DROITE : Résultat & Historique (Span 5) -->
        <aside class="lg:col-span-5 space-y-6">
            
            <!-- Carte Résultat -->
            <div class="bg-white/90 dark:bg-dark-card/90 backdrop-blur-xl rounded-[2rem] shadow-2xl border border-white/60 dark:border-slate-700/60 p-8 flex flex-col items-center justify-center min-h-[400px] sticky top-8 animate-slide-in" style="animation-delay: 0.1s;">
                
                <div class="text-center mb-6">
                    <h2 class="text-lg font-bold dark:text-white" data-i18n="headerResult">Generated Code</h2>
                    <p class="text-xs text-slate-400" data-i18n="subResult">Ready to scan</p>
                </div>

                <!-- Zone QR -->
                <div class="relative group">
                    <div class="absolute -inset-2 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-[28px] blur opacity-20 group-hover:opacity-40 transition duration-500"></div>
                    <div class="relative bg-white p-6 rounded-[20px] shadow-lg">
                        <div id="qrcode" class="overflow-hidden flex items-center justify-center">
                            <!-- Placeholder vide -->
                            <div class="w-[200px] h-[200px] bg-slate-100 flex items-center justify-center text-slate-300 rounded-lg">
                                <i class="fa-solid fa-qrcode text-4xl opacity-20"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="grid grid-cols-4 gap-2 mt-8 w-full">
                    <button onclick="downloadQR()" class="col-span-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg hover:shadow-indigo-500/30 transition-all transform hover:-translate-y-0.5 active:translate-y-0 flex items-center justify-center gap-2 text-sm">
                        <i class="fa-solid fa-download"></i> <span data-i18n="btnPng">PNG</span>
                    </button>
                    <!-- Bouton Partager (New) -->
                    <button onclick="shareQR()" class="col-span-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-900/50 font-bold rounded-xl transition-all flex items-center justify-center" title="Partager">
                        <i class="fa-solid fa-share-nodes"></i>
                    </button>
                    <!-- Bouton Print -->
                    <button onclick="window.print()" class="col-span-1 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold rounded-xl transition-all flex items-center justify-center" title="Imprimer">
                        <i class="fa-solid fa-print"></i>
                    </button>
                </div>
            </div>

            <!-- Historique (Local Storage) -->
            <div class="bg-white/80 dark:bg-dark-card/80 backdrop-blur rounded-3xl border border-white/50 dark:border-slate-700 p-6 shadow-lg animate-slide-in" style="animation-delay: 0.2s;">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-sm dark:text-white"><i class="fa-solid fa-clock-rotate-left mr-2 text-indigo-500"></i><span data-i18n="headerHistory">Recent</span></h3>
                    <button onclick="clearHistory()" class="text-xs text-red-400 hover:text-red-600 font-medium" data-i18n="btnClear">Clear All</button>
                </div>
                <ul id="historyList" class="space-y-3 max-h-[300px] overflow-y-auto pr-2 custom-scrollbar">
                    <li class="text-xs text-center text-slate-400 py-4" data-i18n="noHistory">No recent history</li>
                </ul>
            </div>

        </aside>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script type="text/javascript">
        // --- LOCALIZATION / TRADUCTION ---
        const i18n = {
            en: {
                title: "QR Master Ultimate",
                subtitle: "Universal & Free Generator",
                tabUrl: "URL", tabWifi: "Wi-Fi", tabText: "Text", tabVcard: "Contact", tabWhatsapp: "WhatsApp", tabEvent: "Event", tabCrypto: "Crypto", tabGeo: "GPS",
                labelUrl: "Destination URL",
                labelSsid: "Network Name (SSID)", labelPass: "Password", labelSecurity: "Security", securityNone: "None",
                labelFirst: "First Name", labelLast: "Last Name", labelPhone: "Phone", labelEmail: "Email",
                labelWaPhone: "WhatsApp Number", waHelp: "Include country code (e.g. +33)", labelWaMsg: "Pre-filled Message",
                labelTitle: "Event Title", labelStart: "Start", labelEnd: "End", labelLoc: "Location",
                labelCoin: "Currency Type", labelAddr: "Wallet Address", labelAmount: "Amount (Optional)",
                labelLat: "Latitude", labelLon: "Longitude", btnLoc: "Use my location",
                labelText: "Free Text",
                headerCust: "Customization", labelColor: "Color", labelBg: "Background", labelEcc: "Error Correction", labelCode: "Code", labelBgInd: "Back",
                headerResult: "Generated Code", subResult: "Ready to scan", btnPng: "PNG",
                headerHistory: "Recent", btnClear: "Clear All", noHistory: "No recent history",
                // Placeholders
                phUrl: "https://mysite.com", phSsid: "MyNetwork", phWaPhone: "+1 234 567 8900", phWaMsg: "Hello...",
                phTitle: "Meeting...", phLoc: "New York...", phAddr: "1A1z...", phAmount: "0.5", phLat: "40.7128", phLon: "-74.0060",
                // Toasts
                toastDark: "Dark mode enabled", toastLight: "Light mode enabled",
                toastLocFinding: "Locating...", toastLocSuccess: "Position found!", toastLocError: "Location error", toastLocUnsup: "Geolocation not supported",
                toastDownload: "QR Code downloaded!", toastNoDownload: "Nothing to download...",
                toastShareSuccess: "Shared successfully!", toastShareError: "Error sharing",
                toastDeleted: "Item deleted", toastCleared: "History cleared", toastRestored: "Restored from history"
            },
            fr: {
                title: "QR Master Ultimate",
                subtitle: "Générateur universel & gratuit",
                tabUrl: "URL", tabWifi: "Wi-Fi", tabText: "Texte", tabVcard: "Contact", tabWhatsapp: "WhatsApp", tabEvent: "Agenda", tabCrypto: "Crypto", tabGeo: "GPS",
                labelUrl: "Lien de destination",
                labelSsid: "Nom du réseau (SSID)", labelPass: "Mot de passe", labelSecurity: "Sécurité", securityNone: "Aucun",
                labelFirst: "Prénom", labelLast: "Nom", labelPhone: "Téléphone", labelEmail: "Email",
                labelWaPhone: "Numéro WhatsApp", waHelp: "Incluez l'indicatif pays (ex: +33)", labelWaMsg: "Message pré-rempli",
                labelTitle: "Titre de l'événement", labelStart: "Début", labelEnd: "Fin", labelLoc: "Lieu",
                labelCoin: "Type de Monnaie", labelAddr: "Adresse du portefeuille", labelAmount: "Montant (Optionnel)",
                labelLat: "Latitude", labelLon: "Longitude", btnLoc: "Utiliser ma position",
                labelText: "Texte libre",
                headerCust: "Personnalisation", labelColor: "Couleur", labelBg: "Arrière-plan", labelEcc: "Correction d'erreur", labelCode: "Code", labelBgInd: "Fond",
                headerResult: "Code Généré", subResult: "Prêt à être scanné", btnPng: "PNG",
                headerHistory: "Récent", btnClear: "Tout effacer", noHistory: "Aucun historique récent",
                // Placeholders
                phUrl: "https://monsite.com", phSsid: "MaBoxInternet", phWaPhone: "+33 6 12 34 56 78", phWaMsg: "Bonjour...",
                phTitle: "Réunion...", phLoc: "Paris...", phAddr: "1A1z...", phAmount: "0.5", phLat: "48.8566", phLon: "2.3522",
                // Toasts
                toastDark: "Mode sombre activé", toastLight: "Mode clair activé",
                toastLocFinding: "Localisation en cours...", toastLocSuccess: "Position trouvée !", toastLocError: "Erreur de localisation", toastLocUnsup: "Géolocalisation non supportée",
                toastDownload: "QR Code téléchargé !", toastNoDownload: "Rien à télécharger...",
                toastShareSuccess: "Partagé avec succès !", toastShareError: "Erreur lors du partage",
                toastDeleted: "Élément supprimé", toastCleared: "Historique vidé", toastRestored: "Code restauré depuis l'historique"
            }
        };

        let currentLang = 'en'; // English Default

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'fr' : 'en';
            localStorage.setItem('qr-lang', currentLang);
            updateLanguageUI();
        }

        function updateLanguageUI() {
            // Update Toggle Button
            const btn = document.getElementById('langBtn');
            btn.textContent = currentLang.toUpperCase();
            
            // Update Text Content
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(i18n[currentLang][key]) el.textContent = i18n[currentLang][key];
            });

            // Update Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if(i18n[currentLang][key]) el.placeholder = i18n[currentLang][key];
            });

            // Update HTML Lang attribute
            document.documentElement.lang = currentLang;
            
            // Re-render history to translate specific generic messages if needed (though user data remains same)
            renderHistory();
        }

        // --- LOGIQUE SÉCURITÉ WIFI (DROPDOWN CUSTOM) ---
        function toggleSecurityMenu() {
            const menu = document.getElementById('wifiTypeMenu');
            const btn = document.getElementById('wifiTypeBtn').querySelector('.fa-chevron-down');
            menu.classList.toggle('hidden');
            btn.style.transform = menu.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
        }

        function setSecurity(value, label, iconClass) {
            document.getElementById('wifiType').value = value;
            // Handle translated "None" label specifically if needed, but for simplicity keeping label passed
            let displayLabel = label;
            if (value === 'nopass') displayLabel = i18n[currentLang].securityNone;
            
            document.getElementById('wifiTypeLabel').innerHTML = `<i class="fa-solid ${iconClass} text-xs"></i> ${displayLabel}`;
            toggleSecurityMenu();
            triggerLiveGen();
        }
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.relative.group.z-30')) {
                document.getElementById('wifiTypeMenu').classList.add('hidden');
                const btn = document.getElementById('wifiTypeBtn');
                if(btn) btn.querySelector('.fa-chevron-down').style.transform = 'rotate(0deg)';
            }
        });

        // --- GESTION DU MODE SOMBRE ---
        function toggleDarkMode() {
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('qr-theme', isDark ? 'dark' : 'light');
            showToast(isDark ? i18n[currentLang].toastDark : i18n[currentLang].toastLight);
        }
        if (localStorage.getItem('qr-theme') === 'dark' || (!localStorage.getItem('qr-theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        // --- GÉOLOCALISATION ---
        function getMyLocation() {
            if (navigator.geolocation) {
                showToast(i18n[currentLang].toastLocFinding, "info");
                navigator.geolocation.getCurrentPosition((pos) => {
                    document.getElementById('geoLat').value = pos.coords.latitude.toFixed(6);
                    document.getElementById('geoLon').value = pos.coords.longitude.toFixed(6);
                    triggerLiveGen();
                    showToast(i18n[currentLang].toastLocSuccess, "success");
                }, () => showToast(i18n[currentLang].toastLocError, "error"));
            } else {
                showToast(i18n[currentLang].toastLocUnsup, "error");
            }
        }

        // --- UI & TABS ---
        function handleTypeChange() {
            const type = document.querySelector('input[name="qrType"]:checked').value;
            document.querySelectorAll('.input-section').forEach(el => el.classList.add('hidden-section'));
            
            const active = document.getElementById(`section-${type}`);
            if(active) {
                active.classList.remove('hidden-section');
                active.classList.add('animate-fade-in');
            }
            triggerLiveGen(); 
        }

        // --- MOTEUR DE GÉNÉRATION ---
        let debounceTimer;
        let qrCodeObj = null;

        function triggerLiveGen() {
            clearTimeout(debounceTimer);
            const colorDark = document.getElementById('colorDark').value;
            const colorLight = document.getElementById('colorLight').value;
            document.getElementById('previewDark').style.backgroundColor = colorDark;
            document.getElementById('previewLight').style.backgroundColor = colorLight;

            debounceTimer = setTimeout(generateQR, 400);
        }

        function generateQR() {
            const type = document.querySelector('input[name="qrType"]:checked').value;
            let data = "";
            let label = "";

            switch(type) {
                case 'url':
                    data = document.getElementById('urlInput').value.trim();
                    label = data.substring(0, 25) + (data.length>25 ? '...' : '');
                    if(!data) return clearQR();
                    break;
                case 'wifi':
                    const ssid = document.getElementById('wifiSSID').value.trim();
                    const pass = document.getElementById('wifiPass').value;
                    const algo = document.getElementById('wifiType').value;
                    if(!ssid) return clearQR();
                    data = `WIFI:S:${ssid};T:${algo};P:${pass};;`;
                    label = `WiFi: ${ssid}`;
                    break;
                case 'whatsapp':
                    const waPhone = document.getElementById('waPhone').value.trim().replace(/[^0-9+]/g, '');
                    const waMsg = document.getElementById('waMessage').value;
                    if(!waPhone) return clearQR();
                    data = `https://wa.me/${waPhone}?text=${encodeURIComponent(waMsg)}`;
                    label = `WhatsApp: ${waPhone}`;
                    break;
                case 'event':
                    const title = document.getElementById('evTitle').value.trim();
                    if(!title) return clearQR();
                    const formatDate = (d) => d.replace(/[-:]/g, '') + '00';
                    const start = document.getElementById('evStart').value;
                    const end = document.getElementById('evEnd').value;
                    const loc = document.getElementById('evLoc').value;
                    
                    data = `BEGIN:VEVENT\nSUMMARY:${title}\nLOCATION:${loc}\nDTSTART:${formatDate(start)}\nDTEND:${formatDate(end)}\nEND:VEVENT`;
                    label = `Event: ${title}`;
                    break;
                case 'crypto':
                    const coin = document.getElementById('cryptoType').value;
                    const addr = document.getElementById('cryptoAddr').value.trim();
                    const amount = document.getElementById('cryptoAmount').value;
                    if(!addr) return clearQR();
                    data = `${coin}:${addr}${amount ? '?amount='+amount : ''}`;
                    label = `${coin.toUpperCase()}: ${addr.substr(0,6)}...`;
                    break;
                case 'geo':
                    const lat = document.getElementById('geoLat').value.trim();
                    const lon = document.getElementById('geoLon').value.trim();
                    if(!lat || !lon) return clearQR();
                    data = `geo:${lat},${lon}`;
                    label = `GPS: ${lat}, ${lon}`;
                    break;
                case 'vcard':
                    const fn = document.getElementById('vcardFirst').value.trim();
                    const ln = document.getElementById('vcardLast').value.trim();
                    const tel = document.getElementById('vcardPhone').value.trim();
                    const email = document.getElementById('vcardEmail').value.trim();
                    if(!fn && !ln) return clearQR();
                    data = `BEGIN:VCARD\nVERSION:3.0\nN:${ln};${fn}\nFN:${fn} ${ln}\nTEL;TYPE=CELL:${tel}\nEMAIL:${email}\nEND:VCARD`;
                    label = `Contact: ${fn} ${ln}`;
                    break;
                case 'text':
                    data = document.getElementById('textInput').value.trim();
                    if(!data) return clearQR();
                    label = data.substring(0, 15) + "...";
                    break;
            }

            const container = document.getElementById('qrcode');
            container.innerHTML = "";
            
            const colorDark = document.getElementById('colorDark').value;
            const colorLight = document.getElementById('colorLight').value;
            const eccMap = { 'L': QRCode.CorrectLevel.L, 'M': QRCode.CorrectLevel.M, 'Q': QRCode.CorrectLevel.Q, 'H': QRCode.CorrectLevel.H };
            const ecc = eccMap[document.getElementById('eccLevel').value];

            try {
                qrCodeObj = new QRCode(container, {
                    text: data,
                    width: 200,
                    height: 200,
                    colorDark : colorDark,
                    colorLight : colorLight,
                    correctLevel : ecc
                });
                addToHistory(type, label, data);
            } catch(e) {
                console.error("Erreur génération", e);
            }
        }

        function clearQR() {
            document.getElementById('qrcode').innerHTML = `
                <div class="w-[200px] h-[200px] bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-300 rounded-lg">
                    <i class="fa-solid fa-qrcode text-4xl opacity-20"></i>
                </div>`;
        }

        // --- DOWNLOAD & SHARE ---
        function downloadQR() {
            const img = document.querySelector('#qrcode img');
            if (img && img.src) {
                const link = document.createElement('a');
                link.href = img.src;
                link.download = `qrcode-${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast(i18n[currentLang].toastDownload, "success");
            } else {
                showToast(i18n[currentLang].toastNoDownload, "error");
            }
        }

        async function shareQR() {
            const img = document.querySelector('#qrcode img');
            if (!img || !img.src) return showToast(i18n[currentLang].toastNoDownload, "error");
            
            try {
                const blob = await (await fetch(img.src)).blob();
                const file = new File([blob], "qrcode.png", { type: blob.type });
                
                if (navigator.share) {
                    await navigator.share({
                        title: 'QR Code',
                        files: [file]
                    });
                    showToast(i18n[currentLang].toastShareSuccess, "success");
                } else {
                    showToast(i18n[currentLang].toastShareError, "error");
                }
            } catch (error) {
                console.error(error);
            }
        }

        // --- HISTORIQUE ---
        function addToHistory(type, label, data) {
            let history = JSON.parse(localStorage.getItem('qr-history') || '[]');
            if(history.length > 0 && history[0].data === data) return;

            const newItem = {
                id: Date.now(),
                type: type,
                label: label,
                data: data,
                date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            };

            history.unshift(newItem);
            if(history.length > 10) history.pop();
            
            localStorage.setItem('qr-history', JSON.stringify(history));
            renderHistory();
        }

        function deleteHistoryItem(id, event) {
            event.stopPropagation();
            let history = JSON.parse(localStorage.getItem('qr-history') || '[]');
            history = history.filter(item => item.id !== id);
            localStorage.setItem('qr-history', JSON.stringify(history));
            renderHistory();
            showToast(i18n[currentLang].toastDeleted);
        }

        function renderHistory() {
            const list = document.getElementById('historyList');
            const history = JSON.parse(localStorage.getItem('qr-history') || '[]');
            
            if(history.length === 0) {
                list.innerHTML = `<li class="text-xs text-center text-slate-400 py-4">${i18n[currentLang].noHistory}</li>`;
                return;
            }

            list.innerHTML = history.map(item => `
                <li class="bg-slate-50 dark:bg-slate-700/50 p-3 rounded-xl border border-slate-100 dark:border-slate-700 flex items-center justify-between group cursor-pointer hover:bg-white dark:hover:bg-slate-700 transition-colors shadow-sm relative overflow-hidden" onclick="restoreFromHistory('${item.data}')">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-8 h-8 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 flex items-center justify-center text-xs shrink-0">
                            <i class="fa-solid ${getIconForType(item.type)}"></i>
                        </div>
                        <div class="flex flex-col overflow-hidden">
                            <span class="text-xs font-bold text-slate-700 dark:text-slate-200 truncate">${item.label}</span>
                            <span class="text-[10px] text-slate-400">${item.date}</span>
                        </div>
                    </div>
                    
                    <button onclick="deleteHistoryItem(${item.id}, event)" class="w-8 h-8 rounded-full hover:bg-red-100 text-slate-300 hover:text-red-500 transition-colors flex items-center justify-center z-10">
                        <i class="fa-solid fa-trash text-xs"></i>
                    </button>
                </li>
            `).join('');
        }

        function clearHistory() {
            localStorage.removeItem('qr-history');
            renderHistory();
            showToast(i18n[currentLang].toastCleared);
        }

        function getIconForType(type) {
            const icons = { 
                url: 'fa-link', wifi: 'fa-wifi', text: 'fa-align-left', 
                whatsapp: 'fa-brands fa-whatsapp', event: 'fa-calendar-days', 
                crypto: 'fa-brands fa-bitcoin', geo: 'fa-map-location-dot', 
                vcard: 'fa-address-card' 
            };
            return icons[type] || 'fa-qrcode';
        }
        
        function restoreFromHistory(dataString) {
            const container = document.getElementById('qrcode');
            container.innerHTML = "";
            const eccMap = { 'L': QRCode.CorrectLevel.L, 'M': QRCode.CorrectLevel.M, 'Q': QRCode.CorrectLevel.Q, 'H': QRCode.CorrectLevel.H };
            const ecc = eccMap[document.getElementById('eccLevel').value];
            
            new QRCode(container, {
                text: dataString,
                width: 200,
                height: 200,
                colorDark : document.getElementById('colorDark').value,
                colorLight : document.getElementById('colorLight').value,
                correctLevel : ecc
            });
            showToast(i18n[currentLang].toastRestored);
        }

        // --- TOAST NOTIFICATIONS ---
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const colors = type === 'error' ? 'bg-red-500' : (type === 'success' ? 'bg-green-500' : 'bg-slate-800 dark:bg-slate-700');
            
            toast.className = `${colors} text-white px-6 py-3 rounded-full shadow-xl flex items-center gap-3 transform translate-y-10 opacity-0 transition-all duration-300 mb-3 text-sm font-medium backdrop-blur-md`;
            toast.innerHTML = `<i class="fa-solid ${type === 'success' ? 'fa-check' : (type === 'error' ? 'fa-triangle-exclamation' : 'fa-info-circle')}"></i><span>${message}</span>`;
            container.appendChild(toast);

            requestAnimationFrame(() => toast.classList.remove('translate-y-10', 'opacity-0'));
            setTimeout(() => {
                toast.classList.add('translate-y-10', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        window.onload = function() {
            if(localStorage.getItem('qr-lang')) {
                currentLang = localStorage.getItem('qr-lang');
            }
            updateLanguageUI(); // Apply language
            renderHistory();
            triggerLiveGen(); 
        };
    </script>
</body>
</html>